/*
 * jQuery Mobile Framework : plugin to provide a date and time picker.
 * Copyright (c) JTSage
 * CC 3.0 Attribution.  May be relicensed without permission/notification.
 * https://github.com/jtsage/jquery-mobile-datebox
 */
(function(a){a.extend(a.mobile.datebox.prototype.options,{themeButton:"a",themeInput:"e",useSetButton:true,validHours:false,repButton:true});a.extend(a.mobile.datebox.prototype,{_dbox_run:function(){var b=this;b.drag.didRun=true;b._offset(b.drag.target[0],b.drag.target[1]);b.runButton=setTimeout(function(){b._dbox_run()},150)},_dbox_vhour:function(g){var b=this,f=this.options,e,d=[25,0],c=[25,0];if(f.validHours===false){return true}if(a.inArray(b.theDate.getHours(),f.validHours)>-1){return true}e=b.theDate.getHours();a.each(f.validHours,function(){if(((e<this)?1:-1)===g){if(d[0]>Math.abs(this-e)){d=[Math.abs(this-e),parseInt(this,10)]}}else{if(c[0]>Math.abs(this-e)){c=[Math.abs(this-e),parseInt(this,10)]}}});if(d[1]!==0){b.theDate.setHours(d[1])}else{b.theDate.setHours(c[1])}},_dbox_enter:function(c){var b=this;if(c.jqmData("field")==="M"&&a.inArray(c.val(),b.__("monthsOfYearShort"))>-1){b.theDate.setMonth(a.inArray(c.val(),b.__("monthsOfYearShort")))}if(c.val()!==""&&c.val().toString().search(/^[0-9]+$/)===0){switch(c.jqmData("field")){case"y":b.theDate.setFullYear(parseInt(c.val(),10));break;case"m":b.theDate.setMonth(parseInt(c.val(),10)-1);break;case"d":b.theDate.setDate(parseInt(c.val(),10));break;case"h":b.theDate.setHours(parseInt(c.val(),10));break;case"i":b.theDate.setMinutes(parseInt(c.val(),10));break}}b.refresh()}});a.extend(a.mobile.datebox.prototype._build,{timebox:function(){this._build.datebox.apply(this,[])},datebox:function(){var s=this,f=this.options,k,q,l,g=-2,n="ui-datebox-",p=a("<div>"),c=a("<fieldset>"),h=p.clone(),j=c.clone(),e=a("<input type='"+s.inputType+"' />").addClass("ui-input-text ui-corner-all ui-shadow-inset ui-body-"+f.themeInput),r=a("<input type='text' />").addClass("ui-input-text ui-corner-all ui-shadow-inset ui-body-"+f.themeInput),m=a("<div>"),b={theme:f.themeButton,icon:"plus",iconpos:"bottom",corners:true,shadow:true},d=a.extend({},b,{icon:"minus",iconpos:"top"});if(typeof s.d.intHTML!=="boolean"){s.d.intHTML.empty().remove()}s.d.headerText=((s._grabLabel()!==false)?s._grabLabel():((f.mode==="datebox")?s.__("titleDateDialogLabel"):s.__("titleTimeDialogLabel")));s.d.intHTML=a("<span>");if(s.inputType!=="number"){e.attr("pattern","[0-9]*")}s.fldOrder=((f.mode==="datebox")?s.__("dateFieldOrder"):s.__("timeFieldOrder"));s._check();s._minStepFix();s._dbox_vhour(typeof s._dbox_delta!=="undefined"?s._dbox_delta:1);if(f.mode==="datebox"){a('<div class="'+n+'header"><h4>'+s._formatter(s.__("headerFormat"),s.theDate)+"</h4></div>").appendTo(s.d.intHTML)}for(k=0;k<=s.fldOrder.length;k++){l=["a","b","c","d","e","f"][k];switch(s.fldOrder[k]){case"y":case"m":case"d":case"h":a("<div>").append(s._makeEl(e,{attr:{field:s.fldOrder[k],amount:1}})).addClass("ui-block-"+l).appendTo(h);s._makeEl(m,{attr:{field:s.fldOrder[k],amount:1}}).addClass("ui-block-"+l).buttonMarkup(b).appendTo(c);s._makeEl(m,{attr:{field:s.fldOrder[k],amount:1}}).addClass("ui-block-"+l).buttonMarkup(d).appendTo(j);g++;break;case"a":if(s.__("timeFormat")===12){a("<div>").append(s._makeEl(r,{attr:{field:s.fldOrder[k],amount:1}})).addClass("ui-block-"+l).appendTo(h);s._makeEl(m,{attr:{field:s.fldOrder[k],amount:1}}).addClass("ui-block-"+l).buttonMarkup(b).appendTo(c);s._makeEl(m,{attr:{field:s.fldOrder[k],amount:1}}).addClass("ui-block-"+l).buttonMarkup(d).appendTo(j);g++}break;case"M":a("<div>").append(s._makeEl(r,{attr:{field:s.fldOrder[k],amount:1}})).addClass("ui-block-"+l).appendTo(h);s._makeEl(m,{attr:{field:s.fldOrder[k],amount:1}}).addClass("ui-block-"+l).buttonMarkup(b).appendTo(c);s._makeEl(m,{attr:{field:s.fldOrder[k],amount:1}}).addClass("ui-block-"+l).buttonMarkup(d).appendTo(j);g++;break;case"i":a("<div>").append(s._makeEl(e,{attr:{field:s.fldOrder[k],amount:f.minuteStep}})).addClass("ui-block-"+l).appendTo(h);s._makeEl(m,{attr:{field:s.fldOrder[k],amount:f.minuteStep}}).addClass("ui-block-"+l).buttonMarkup(b).appendTo(c);s._makeEl(m,{attr:{field:s.fldOrder[k],amount:f.minuteStep}}).addClass("ui-block-"+l).buttonMarkup(d).appendTo(j);g++;break}}c.addClass("ui-grid-"+["a","b","c","d","e"][g]).appendTo(s.d.intHTML);h.addClass("ui-datebox-dboxin").addClass("ui-grid-"+["a","b","c","d","e"][g]).appendTo(s.d.intHTML);j.addClass("ui-grid-"+["a","b","c","d","e"][g]).appendTo(s.d.intHTML);h.find("input").each(function(){switch(a(this).jqmData("field")){case"y":a(this).val(s.theDate.getFullYear());break;case"m":a(this).val(s.theDate.getMonth()+1);break;case"d":a(this).val(s.theDate.getDate());break;case"h":if(s.__("timeFormat")===12){if(s.theDate.getHours()>12){a(this).val(s.theDate.getHours()-12);break}else{if(s.theDate.getHours()===0){a(this).val(12);break}}}a(this).val(s.theDate.getHours());break;case"i":a(this).val(s._zPad(s.theDate.getMinutes()));break;case"M":a(this).val(s.__("monthsOfYearShort")[s.theDate.getMonth()]);break;case"a":a(this).val((s.theDate.getHours()>11)?s.__("meridiem")[1]:s.__("meridiem")[0]);break}});if(s.dateOK!==true){h.find("input").addClass(n+"griddate-disable")}else{h.find("."+n+"griddate-disable").removeClass(n+"griddate-disable")}if(f.useSetButton||f.useClearButton){q=a("<div>",{"class":n+"controls"});if(f.useSetButton){a('<a href="#">'+((f.mode==="datebox")?s.__("setDateButtonLabel"):s.__("setTimeButtonLabel"))+"</a>").appendTo(q).buttonMarkup({theme:f.theme,icon:"check",iconpos:"left",corners:true,shadow:true}).on(f.clickEventAlt,function(i){i.preventDefault();if(s.dateOK===true){s.d.input.trigger("datebox",{method:"set",value:s._formatter(s.__fmt(),s.theDate),date:s.theDate});s.d.input.trigger("datebox",{method:"close"})}})}if(f.useClearButton){a('<a href="#">'+s.__("clearButton")+"</a>").appendTo(q).buttonMarkup({theme:f.theme,icon:"delete",iconpos:"left",corners:true,shadow:true}).on(f.clickEventAlt,function(i){i.preventDefault();s.d.input.val("");s.d.input.trigger("datebox",{method:"clear"});s.d.input.trigger("datebox",{method:"close"})})}if(f.useCollapsedBut){q.addClass("ui-datebox-collapse")}q.appendTo(s.d.intHTML)}if(f.repButton===false){c.on(f.clickEvent,"div",function(i){i.preventDefault();s._dbox_delta=1;s._offset(a(this).jqmData("field"),a(this).jqmData("amount"))});j.on(f.clickEvent,"div",function(i){i.preventDefault();s._dbox_delta=-1;s._offset(a(this).jqmData("field"),a(this).jqmData("amount")*-1)})}h.on("change","input",function(){s._dbox_enter(a(this))});if(s.wheelExists){h.on("mousewheel","input",function(i,o){i.preventDefault();s._dbox_delta=o<0?-1:1;s._offset(a(this).jqmData("field"),((o<0)?-1:1)*a(this).jqmData("amount"))})}if(f.repButton===true){c.on(s.drag.eStart,"div",function(i){l=[a(this).jqmData("field"),a(this).jqmData("amount")];s.drag.move=true;s._dbox_delta=1;s._offset(l[0],l[1]);if(!s.runButton){s.drag.target=l;s.runButton=setTimeout(function(){s._dbox_run()},500)}});j.on(s.drag.eStart,"div",function(i){l=[a(this).jqmData("field"),a(this).jqmData("amount")*-1];s.drag.move=true;s._dbox_delta=-1;s._offset(l[0],l[1]);if(!s.runButton){s.drag.target=l;s.runButton=setTimeout(function(){s._dbox_run()},500)}})}}});a.extend(a.mobile.datebox.prototype._drag,{timebox:function(){this._drag.datebox.apply(this)},datebox:function(){var b=this,d=this.options,c=this.drag;if(d.repButton===true){a(document).on(c.eEndA,function(f){if(c.move){f.preventDefault();clearTimeout(b.runButton);b.runButton=false;c.move=false}})}}})})(jQuery);